@page "/register" 
@using System.Data.SQLite;
@using Newtonsoft.Json;
@using System;
@using System.Net.Http;
@using System.Text;

@inject HttpClient httpClient


<h2>Register</h2>

@if(ErrorRaised){
    <div class="error"><strong>Error:</strong> @ErrorMessage</div>
}

<EditForm Model="@_dto" OnValidSubmit="@CreateNewProfile">
    <div class="form-group">
        <label for="username">Username:</label>
        <input type="username" class="form-control" size=30 id="username" placeholder="Enter your username here">
    </div>
    <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" class="form-control" size=30 id="password">
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
</EditForm>

@code{
    private UserDTO _dto = new UserDTO();
        private bool ErrorRaised = false;
    private string ErrorMessage;
    
    public async Task CreateNewProfile()
    {
        var json = JsonConvert.SerializeObject(_dto);
        var data = new StringContent(json, Encoding.UTF8, "application/json");
        
        try
        {
            var response = await httpClient.PostAsync($"/register", data);
            var result = response.Content.ReadAsStringAsync().Result;
            Console.WriteLine(result);
        }
        catch (Exception e)
        {
            ErrorRaised = true;
            ErrorMessage = e.Message;
        } 
    }

    public class UserDTO
    {
        public string Username { get; set; }
        public string Password { get; set; }
    }
}